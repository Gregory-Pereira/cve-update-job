thoth-cve-update-job
--------------------

A job for updating Thoth's CVE database of packages.

This job checks for new CVE records in the
`safety-db <https://github.com/pyupio/safety>`_ provided
by `PyUp.io <https://pyup.io/>`_. If there are new CVE records found,
this job automatically creates corresponding CVE entries in the graph
database.

Installation and Deployment
===========================

This job is run as an OpenShift CronJob that checks for updates in the
safety-db. The deployment templates can be found under the `openshit/`
directory, the Ansible playbooks responsible for deploying this job lives in
the `Thoth's core repository <https://github.com/thoth-station/core>`_.

Running CVE update job locally
==============================

You can run this job locally without any cluster deployment. To do so, issue the following command:

.. code-block:: console

  $ pipenv install  # Install all the requirements
  $ pipenv run python3 ./app.py

The CVE job implementation will by default talk to your local Dgraph instance located on localhost:9080. Follow `local Dgraph setup instructions <https://github.com/thoth-station/storages#running-dgraph-locally>`_ for more info.

If you wish to talk to a Dgraph cluster deployment, you can do so by providing additional configuration options via environment variables:

.. code-block:: console

  $ pipenv install  # Install all the requirements
  $ GRAPH_SERVICE_HOST=graph.test.thoth-station.ninja GRAPH_TLS_PATH=./tls-test pipenv run python3 ./app.py

You need to obtain TLS certificates in order to talk to a remote Dgraph instance and place them into `tls-test` directory in this case.
